<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>planet-x:offline</title>
	<style type="text/css">
		#container{width:500px; height:500px; margin:0 auto;}
		#messages{width:500px; height:100px; overflow:hidden;}
		#actions{width:500px; height:150px;}
		#explorer{width:500px; height:150px;}
		#planet-x{width:500px; height:350px;border:1px solid black; padding-top:20px;}
		#planet-x p {font-family: "courier new";font-size: 10px;margin:0px;margin-left:55px;
		border-width: 0px;padding: 0px;line-height: 5px;}
		.btn{width:150px; height:25px; border:1px solid black; cursor:pointer; 
			text-align: center;padding: 3px; margin:2px;}
		#control{float:left;}
		#work{float:left;}
		#droids{float:left;}

	</style>
</head>
<body>
<div id="container">
	<div id="messages"></div>
	<div id="actions">
		<div id="control">
			<div class="headline">Control Room</div>
			<div id="restartReactor" class="btn">restart reactor</div>
			<div id="restartExtractor" class="btn">restart extractor</div>
			<div id="droidFactory" class="btn">droid factory</div>
		</div>
		<div id="work">
			<div class="headline">Work</div>
			<div id="work-reactor" class="btn">reactor</div>
			<div id="work-extractor" class="btn">extractor</div>
			<div id="work-droid" class="btn">factory</div>			
		</div>
		<div id="droids">
			<div class="headline">Droids</div>
			<div id="droid-reactor" class="btn">+</div>
			<div id="droid-extractor" class="btn">+</div>	
		</div>		
	</div>
	<div id="explorer">
		<div id="upgrades">
			<div class="headline">Upgrade</div>
			<div id="upg-battery" class="btn">battery</div>
			<div id="upg-shield" class="btn">shield</div>	
			<div id="upg-weapon" class="btn">weapon</div>	
		</div>
	</div>
	<div id="planet-x">
		
	</div>
</div>
<script src="map.js"></script>
<script type="text/javascript">
	const messages = {intro:"starship has crashed", intro2:"on a strange planet", 
		intro3:"all systems are offline", resources:"not enough resources"}
	let explorer = {pos:{x:65, y:25}, symbol:"@"}
	function getById(Element){
		return document.getElementById(Element)
	}
	function rmBtn(btn){
		btn.parentNode.removeChild(btn)
	}
	{
	function typeWritter(txt, i=0){
		if ( i<txt.length ){
			document.getElementById("messages").innerHTML += txt.charAt(i)
			i++
			setTimeout(typeWritter, 50, txt, i)
		}
		else{document.getElementById("messages").innerHTML += "<br>"}
	}}
	function cooldown(time, button, btnText, callback){
		const fullTime = time;
		(function recursive(time, fullTime, button, btnText, callback){
			if (time<=0){
				button.textContent = btnText
				let percentage = 0
				let linearGradient = "linear-gradient(to right, gray, gray "+ percentage+
				"%, transparent "+ percentage+"%)"
				button.style.backgroundImage = linearGradient
				button.style.opacity = "1"
				callback[0](...callback.slice(1))
				return time
			}
			let percentage = (time/fullTime)*100
			let linearGradient = "linear-gradient(to right, rgba(0, 0, 0, 0.35) "+ percentage+
				"%, rgba(0, 0, 0, 0) "+ percentage+"%)";
			button.style.backgroundImage = linearGradient
			button.style.opacity = "0.5"
			setTimeout(function() {
				return recursive(time-10, fullTime, button, btnText, callback);
			}, 10);			
		}(time, fullTime, button, btnText, callback))
	}
	function display(){
		for ( let lat=0; lat<listOfLatitudes.length; lat++){
			let row = document.createElement("p");
			row.setAttribute("class", "latitude")
			row.setAttribute("id", lat);
			row.innerHTML = listOfLatitudes[lat].toString().replace(/,/g, "", )
			planet.appendChild(row);
		}
	}
	function display2(){
		for ( let lat=0; lat<map.length; lat++){
			let row = document.createElement("p");
			row.setAttribute("class", "latitude")
			row.setAttribute("id", lat);
			for ( let lon=0; lon<map[0].length; lon++){
				row.innerHTML += map[lat][lon].symbol
			}
			planet.appendChild(row);
		}
	}
	function display3(dx=0){
		center={x:35, y:35}
		radius=37
		let lats = planet.getElementsByTagName("p");
		for ( let i=0; i<map.length; i++ ){
			let rowHTML = "";
			for ( let j=0; j<map.length; j++ ){
				if ( (i-center.x)**2 + (j-center.y)**2 <= radius**2 ){
					let x = explorer.pos.x+dx-this.center.x+j;
					let y = i;
					//x = map.validX(x);
					//y = map.validY(y);
					//let symbol = ( map.isVisible(x,y) )?  map[y][x].symbol:String.fromCharCode(178);
					let symbol = ( true )?  map[y][x].symbol:String.fromCharCode(178);
					//symbol = ( map.isExplorer(x,y) )?  explorer.symbol:symbol;
					rowHTML += symbol;
				}
				else {
					rowHTML += "\u00A0";
				}
			}
			lats[i].innerHTML = rowHTML+"</span>";
		}
	}
	const container = getById("container")
	const restartReactor = getById("restartReactor")
	typeWritter(messages.intro)
	setTimeout(typeWritter, 1500, messages.intro2)
	setTimeout(typeWritter, 3000, messages.intro3)
	setTimeout(()=>{restartReactor.style.visibility = "visible"}, 5000)
	/*world map*/
	const planet = getById("planet-x")
	const map =[]
	for ( let i=0; i<planetRLE.length; i++ ){
		map.push([])
		flag = false
		index = 0
		planetRLE[i].unshift(0)
		planetRLE[i].push(135)
		for ( let j=0; j<planetRLE[i][planetRLE[i].length-1]; j++){
			if ( planetRLE[i][index] === j ){
				flag = !flag
				index++
			}
			map[i].push( (flag)? {symbol:'\u00A0'}:{symbol:'*'} )
			//listOfLatitudes[i].push( (flag)? '*':'\u00A0' )
		}
		console.log(map[i])
	}
	display2()
	display3()
</script>
</body>
</html>

